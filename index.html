<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { background: #000; overflow: hidden; height: 100vh; width: 100vw; font-family: monospace; }
  #superContainer { display: flex; flex-direction: column; height: 100vh; width: 100vw; }

  /* 1. IMAGE BOX (40vh) - Tablet Safe */
  #top { height: 40vh; width: 100%; display: flex; justify-content: center; align-items: center; border-bottom: 2px solid #333; background: #000; }
  #top img { height: 90%; width: auto; object-fit: contain; }

  /* 2. NERD BOX (40vh) - Absolute Canon */
  #mid {
    height: 40vh; width: 100%; background: #000;
    display: flex; flex-direction: column; justify-content: space-evenly; align-items: center;
    padding: 10px; border-bottom: 2px solid #333;
  }
  .white-line { color: #ffffff !important; font-size: 20px; font-weight: bold; text-align: center; width: 100%; text-transform: uppercase; letter-spacing: 1px; }
  .effect-line { color: #ffffff !important; font-size: 16px; opacity: 0.8; font-style: italic; text-align: center; min-height: 40px; padding: 0 15px; }
  .stats-grid { width: 100%; border-top: 1px solid #222; padding-top: 5px; display: flex; justify-content: space-around; color: #ffffff; font-size: 16px; }
  .res-num { color: #0f0; font-weight: bold; }
  .res-label { color: #fff; opacity: 0.7; }

  /* 3. BUTTON BAR (20vh) - Elevated for Samsung/Tablet Navigation Bar safety */
  #bot { 
    height: 20vh; width: 100%; 
    display: flex; flex-direction: column; justify-content: flex-start; align-items: center; 
    background: #080808; padding-top: 15px;
  }
  .row { display: flex; gap: 25px; margin-bottom: 12px; }
  .btn { 
    width: 145px; height: 55px; border: 4px solid #fff; border-radius: 10px; 
    color: #fff; font-weight: bold; font-size: 15px; cursor: pointer; 
    transition: all 0.1s; position: relative; text-transform: uppercase;
  }
  .btn:active { transform: scale(0.95); }
  .btn:disabled { cursor: not-allowed; border-color: #333; color: #555; }
  
  /* Space for physical/virtual home buttons on tablets */
  #ghost { height: 20px; width: 100%; } 
</style>
</head>
<body>
<div id="superContainer">
  <div id="top"><img id="ageImg" src="https://user.uploads.dev/file/fe81017f6eaa2d4475633a99025a08db.jpg"></div>
  
  <div id="mid">
    <div id="news" class="white-line">SYSTEM ONLINE: TERRARIUM SEALED</div>
    <div id="last" class="white-line" style="font-size: 18px; color: #aaa !important;">[OBSERVER STANDBY]</div>
    <div id="effect" class="effect-line">Waiting for initial subject stimulus...</div>
    <div class="stats-grid"><span>YEAR: <span id="yVal">-7000</span></span><span>AGE: <span id="aVal">STONE AGE</span></span></div>
    <div class="stats-grid"><span>CIV 1: <span id="p1">1000</span> | <span class="res-label" id="rL1">FOOD:</span> <span id="r1" class="res-num">100</span>%</span></div>
    <div class="stats-grid"><span>CIV 2: <span id="p2">1000</span> | <span class="res-label" id="rL2">FOOD:</span> <span id="r2" class="res-num">100</span>%</span></div>
  </div>

  <div id="bot">
    <div class="row">
      <button class="btn" style="background:#800" onclick="act(0)" id="b0"></button>
      <button class="btn" style="background:#800" onclick="act(1)" id="b1"></button>
    </div>
    <div class="row">
      <button class="btn" style="background:#004" onclick="act(2)" id="b2"></button>
      <button class="btn" style="background:#004" onclick="act(3)" id="b3"></button>
    </div>
    <div id="ghost"></div>
  </div>
</div>

<script>
  /* CANON VARIABLES */
  let yr=-7000, age=1, p1=1000, p2=1000, res1=100, res2=100;
  let active=false, paused=false, volatility=0, secCounter=0;
  let cooldowns = [0, 0, 0, 0];
  
  const pool = ["HUNT","GATHER","FIRE","RITUAL","RAID","HIDE","TEACH","EXPLORE","FEAR","ADAPT","REST","OBSERVE","DOMINATE","MERGE","BUILD","SACRIFICE"];
  
  const outcomes = {
    "HUNT": "Nutrition secured; bloodlust rising.",
    "GATHER": "Stocks filled; land depletion noted.",
    "FIRE": "Comfort granted; ashes drift upward.",
    "RITUAL": "Faith heightened; reason retreats.",
    "SACRIFICE": "The few fall so the many might fear.",
    "TEACH": "Knowledge spreads; secrets leaked.",
    "FEAR": "Obedience ensured; the soul shrinks.",
    "RAID": "Wealth stolen; cycles of hatred begin.",
    "ADAPT": "The weak perish; the strong grow cold.",
    "DEFAULT": "Action registered; equilibrium shifts."
  };

  function roll() {
    let picks = [...pool].sort(()=>.5-Math.random()).slice(0,4);
    for(let i=0;i<4;i++) {
        let btn = document.getElementById('b'+i);
        if(cooldowns[i] <= 0) {
          btn.innerText = picks[i];
          btn.style.opacity = "1.0";
          btn.disabled = false;
        }
    }
    secCounter = 0;
    return picks;
  }

  let current = roll();

  function act(s) {
    if(paused || cooldowns[s] > 0) {
        if(cooldowns[s] > 0) {
            volatility += 8;
            if(volatility > 20) document.getElementById('news').innerText = "SYSTEM STRAIN: TACTICAL PANIC NOTED";
        }
        return;
    }

    active = true;
    let move = current[s];
    document.getElementById('last').innerText = "ACTION: " + move;
    document.getElementById('effect').innerText = outcomes[move] || outcomes["DEFAULT"];

    /* Action Logic */
    if(s < 2) { // Civ 1 Bias
      if(["HUNT","GATHER"].includes(move)) res1 = Math.min(100, res1 + 35);
      p1 += 180; p2 -= 60; 
    } else { // Civ 2 Bias
      if(["HUNT","GATHER"].includes(move)) res2 = Math.min(100, res2 + 35);
      p2 += 180; p1 -= 60; 
    }

    /* Rule 16: Cooldown Lockout */
    cooldowns[s] = 4;
    let btn = document.getElementById('b'+s);
    btn.style.opacity = "0.3";
    btn.disabled = true;
    btn.innerText = "4";

    /* Rule 16: Maze Master Volatility */
    if(volatility > 40) {
        current = ["SACRIFICE", "FEAR", "RAID", "RAID"];
        volatility = 0;
        document.getElementById('news').innerText = "VOLATILITY SPIKE: CHOICES RESTRICTED";
    } else {
        current = roll();
    }
    update();
  }

  setInterval(() => {
    if(!active || paused) return;
    
    yr++;
    secCounter++;
    volatility = Math.max(0, volatility - 1);
    
    /* Rule 15: Resource Dwindling */
    let decay = (age === 1) ? 2.0 : (age === 2) ? 1.5 : 2.5;
    res1 -= decay; res2 -= decay;

    /* Hunger Pressure (Rule 15: Triple loss at 0%) */
    let p1Loss = (res1 <= 0) ? 25 : 6; 
    let p2Loss = (res2 <= 0) ? 25 : 6;
    p1 -= p1Loss; p2 -= p2Loss;

    /* Observer Hesitation (8s rotation) */
    if(secCounter >= 8) {
      current = roll();
      document.getElementById('effect').innerText = "OBSERVER HESITATION: POOL ROTATED.";
    }

    /* Plague Law */
    if (p1 > 5000) { p1 = Math.floor(p1 * 0.5); document.getElementById('news').innerText = "NEWS: PLAGUE RAVAGES CIV 1"; }
    if (p2 > 5000) { p2 = Math.floor(p2 * 0.5); document.getElementById('news').innerText = "NEWS: PLAGUE RAVAGES CIV 2"; }

    /* Cooldown Counter Update */
    for(let i=0; i<4; i++) {
        if(cooldowns[i] > 0) {
            cooldowns[i]--;
            if(cooldowns[i] > 0) {
                document.getElementById('b'+i).innerText = cooldowns[i];
            } else {
                let btn = document.getElementById('b'+i);
                btn.style.opacity = "1.0";
                btn.disabled = false;
                btn.innerText = current[i];
            }
        }
    }

    /* Age Transitions & Resources */
    if(yr === -3987 && age === 1) {
        age = 2;
        document.getElementById('aVal').innerText = "MIDDLE AGE";
        document.getElementById('rL1').innerText = "GRAIN:";
        document.getElementById('rL2').innerText = "GRAIN:";
        paused = true;
        document.getElementById('news').innerText = "TRANSITION: THE MIDDLE AGE";
    }
    if(yr === -974 && age === 2) {
        age = 3;
        document.getElementById('aVal').innerText = "MODERN AGE";
        document.getElementById('rL1').innerText = "ENERGY:";
        document.getElementById('rL2').innerText = "ENERGY:";
        paused = true;
        document.getElementById('news').innerText = "TRANSITION: THE MODERN AGE";
    }

    /* Termination */
    if(p1 <= 0 || p2 <= 0) {
      paused = true;
      document.getElementById('news').innerText = "EXPERIMENT TERMINATED";
      setTimeout(() => location.reload(), 5000);
    }
    
    update();
  }, 1000);

  function update() {
    document.getElementById('yVal').innerText = yr;
    document.getElementById('p1').innerText = Math.max(0, Math.floor(p1));
    document.getElementById('p2').innerText = Math.max(0, Math.floor(p2));
    document.getElementById('r1').innerText = Math.max(0, Math.floor(res1));
    document.getElementById('r2').innerText = Math.max(0, Math.floor(res2));
  }
</script>
</body>
</html>
